var h="https://editor.unlayer.com/embed.js?2",f=[],p=!1,y=t=>{let s=document.querySelectorAll("script"),e=!1;return s.forEach(i=>{i.src.includes(t)&&(e=!0)}),e},S=t=>{f.push(t)},u=()=>{if(p){let t;for(;t=f.shift();)t()}},O=(t,s=h)=>{if(S(t),y(s))u();else{let e=document.createElement("script");e.setAttribute("src",s),e.onload=()=>{p=!0,u()},document.head.appendChild(e)}};function m({state:t,displayMode:s,id:e,uploadUrl:i,additionalOptions:g={}}){return{state:t,init(){let r=this;O(()=>{unlayer.init(Object.assign({id:e,displayMode:s},g)),unlayer.registerCallback("image",(n,l)=>{b(n.attachments[0],i).then(a=>l({progress:100,url:a})).catch(a=>console.error("Image upload failed:",a))});let o=!1,d=!0;r.$watch("state",n=>{if(!o){let l=n.design!==void 0?n.design:n;unlayer.loadDesign(JSON.parse(JSON.stringify(l))),d=!1,unlayer.exportHtml(a=>{o=!0,r.state&&(r.state={html:a.html,design:JSON.parse(JSON.stringify(a.design))});let c=document.getElementById(e);c&&(c.dirty=!0),d=!1})}o=!1}),unlayer.addEventListener("design:updated",()=>{unlayer.exportHtml(n=>{d||(o=!0),r.state?r.state=d?{html:r.state.html,design:JSON.parse(JSON.stringify(r.state.design))}:{html:n.html,design:JSON.parse(JSON.stringify(n.design))}:r.state={html:n.html||"",design:JSON.parse(JSON.stringify(n.design||{}))};let l=document.getElementById(e);l&&(l.dirty=!0),d=!1})})})}}}function b(t,s){let e=new FormData;return e.append("file",t),fetch(s,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}).then(i=>{if(i.ok)return i.json();throw new Error("Network response was not ok.")}).then(i=>i.file.url)}document.addEventListener("DOMContentLoaded",()=>{typeof Alpine<"u"&&Alpine.data("initUnlayer",m)});export{m as default,O as loadScript};
