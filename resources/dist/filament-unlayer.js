var g="https://editor.unlayer.com/embed.js?2",f=[],p=!1,h=t=>{let s=document.querySelectorAll("script"),e=!1;return s.forEach(r=>{r.src.includes(t)&&(e=!0)}),e},y=t=>{f.push(t)},u=()=>{if(p){let t;for(;t=f.shift();)t()}},S=(t,s=g)=>{if(y(t),h(s))u();else{let e=document.createElement("script");e.setAttribute("src",s),e.onload=()=>{p=!0,u()},document.head.appendChild(e)}};function m({state:t,displayMode:s,id:e,uploadUrl:r}){return{state:t,init(){let i=this;S(()=>{unlayer.init({id:e,displayMode:s}),unlayer.registerCallback("image",(n,l)=>{O(n.attachments[0],r).then(a=>l({progress:100,url:a})).catch(a=>console.error("Image upload failed:",a))});let o=!1,d=!0;i.$watch("state",n=>{if(!o){let l=n.design!==void 0?n.design:n;unlayer.loadDesign(JSON.parse(JSON.stringify(l))),d=!1,unlayer.exportHtml(a=>{o=!0,i.state&&(i.state={html:a.html,design:JSON.parse(JSON.stringify(a.design))});let c=document.getElementById(e);c&&(c.dirty=!0),d=!1})}o=!1}),unlayer.addEventListener("design:updated",()=>{unlayer.exportHtml(n=>{d||(o=!0),i.state?i.state=d?{html:i.state.html,design:JSON.parse(JSON.stringify(i.state.design))}:{html:n.html,design:JSON.parse(JSON.stringify(n.design))}:i.state={html:n.html||"",design:JSON.parse(JSON.stringify(n.design||{}))};let l=document.getElementById(e);l&&(l.dirty=!0),d=!1})})})}}}function O(t,s){let e=new FormData;return e.append("file",t),fetch(s,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}).then(r=>{if(r.ok)return r.json();throw new Error("Network response was not ok.")}).then(r=>r.file.url)}document.addEventListener("DOMContentLoaded",()=>{typeof Alpine<"u"&&Alpine.data("initUnlayer",m)});export{m as default,S as loadScript};
