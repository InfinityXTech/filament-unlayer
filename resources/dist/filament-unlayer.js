var g="https://editor.unlayer.com/embed.js?2",f=[],p=!1,h=t=>{let n=document.querySelectorAll("script"),e=!1;return n.forEach(s=>{s.src.includes(t)&&(e=!0)}),e},y=t=>{f.push(t)},u=()=>{if(p){let t;for(;t=f.shift();)t()}},S=(t,n=g)=>{if(y(t),h(n))u();else{let e=document.createElement("script");e.setAttribute("src",n),e.onload=()=>{p=!0,u()},document.head.appendChild(e)}};function m({state:t,displayMode:n,id:e,uploadUrl:s}){return{state:t,init(){let r=this;S(()=>{unlayer.init({id:e,displayMode:n}),unlayer.registerCallback("image",(i,a)=>{O(i.attachments[0],s).then(l=>a({progress:100,url:l})).catch(l=>console.error("Image upload failed:",l))});let o=!1,d=!0;r.$watch("state",i=>{if(!o){let a=i.design!==void 0?i.design:i;unlayer.loadDesign(JSON.parse(JSON.stringify(a))),d=!1,unlayer.exportHtml(l=>{o=!0,r.state?r.state={html:l.html,design:JSON.parse(JSON.stringify(l.design))}:r.state={html:l.html||"",design:JSON.parse(JSON.stringify(l.design||{}))};let c=document.getElementById(e);c&&(c.dirty=!0),d=!1})}o=!1}),unlayer.addEventListener("design:updated",()=>{unlayer.exportHtml(i=>{d||(o=!0),r.state&&(r.state=d?{html:r.state.html,design:JSON.parse(JSON.stringify(r.state.design))}:{html:i.html,design:JSON.parse(JSON.stringify(i.design))});let a=document.getElementById(e);a&&(a.dirty=!0),d=!1})})})}}}function O(t,n){let e=new FormData;return e.append("file",t),fetch(n,{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}).then(s=>{if(s.ok)return s.json();throw new Error("Network response was not ok.")}).then(s=>s.file.url)}document.addEventListener("DOMContentLoaded",()=>{typeof Alpine<"u"&&Alpine.data("initUnlayer",m)});export{m as default,S as loadScript};
